# RealmsHost

为 LTSX 提供基础组件和玩家社交活动

[English](./README.md) | **简体中文**

RealmsHost 提供以下组件：

- 玩家职业系统
- 小镇系统
- 玩家好友系统
- 重生点选择器
- 修改原版 MinecraftServer.class 实现 LTSX 特性
- 一些 GUI 组件
- 集成 REI
- 一些实用工具类包括 `ItemUtils`, `PlayerUtils`, `WorldUtils` 等等
- 提供一个可以由其他模组调用的 PlayerHUD 接口
- 全局的 `&` 颜色标识符和聊天格式化代码

## 玩家职业系统

玩家职业系统提供以下三种玩家职业：

- Famer (农业)
- Miner (矿业)
- Knight (狩猎)

`农业 Famer` 为玩家提供农民职业。该职业可以让玩家驯服所有 LTSX 提供的动物，并且一些动物 (如牛、羊等) 会被担任农民职业的玩家所吸引。此外，担任农民职业的玩家会加速附近作物的生长速率，并可以种植一些稀有或难以种植的作物，收割时会有额外收获。

`矿业 Miner` 为玩家提供矿工职业。矿工职业会自带约 `效率III` 的 buff 加成，并且可以掌握高级工具的使用。此外，矿工职业的玩家随机遇到稀有矿物的概率会是其他玩家的 1.5 倍，可以挖掘稀有矿物。此外，化石工业科技树需要矿工职业来点亮。

`狩猎 Knight` 为玩家提供骑士职业。玩家在担任骑士职业时，会有 `速度` 的 buff 加成，吃下带有效果的食物或药水后会自带 30 秒的加时。此外，骑士职业可以驾驭多种稀有武器和附魔，在击杀敌人或怪物时会有概率掉落稀有物品。这些稀有物品是点亮科技树的必要资源。

## 小镇系统

小镇系统提供玩家的聚集地。基于命令或方块的小镇管理系统可以让玩家方便地建立和组织小镇。在玩家加入服务器后，会有提示选择加入现有的小镇还是独立行动。

小镇拥有以下要素：

- 小镇主城
- 小镇商店
- 团地
- 小镇任务中心
- 小镇政府大厅
- 小镇银行
- 小镇工业基地

`小镇主城` 是所有新加入玩家或进行快速传送到小镇的玩家的刷新位置。任何通过传送进入小镇的玩家都会出生在这里。此外，小镇主城提供小镇居民的聚集地和活动中心。判定方法为 `不小于 16x16 的区域`。

`小镇商店` 是小镇官方的贸易交易中心。小镇商店不仅承载着小镇居民的交易需求，还承载着小镇和小镇之间的贸易活动。判定方法为 `具有小镇商店中心方块和商店方块和贸易站方块`。

`团地` 是小镇居民的住所。需要提供一个足够大的场地来让小镇居民自行建造自己的建筑或提供建筑模板。被认领的团地是受到保护的，任何小镇外居民和无权限的小镇居民都不可以破坏团地内的方块。

`小镇任务中心` 是居民领取任务的地点。任务中心会对不同职业的居民提供不同的任务。任务每天刷新 5 个，完成当天任务后会获得稀有奖励。做任务是一个非常快速的成长等级和点亮科技树的方法。

`小镇政府大厅` 是小镇管理方块的所在地。小镇管理方块只允许小镇所有者和拥有权限的小镇居民使用，在这里可以管理小镇的一切。

`小镇银行` 是小镇银行方块的所在地。小镇银行方块存储小镇官方的储蓄。通过在 `小镇商店` 交易所得的贸易货币都会存储在小镇银行。存储在小镇银行的货币无法被挪动或己用。

`小镇工业基地` 是小镇提供生产力的地点。这里包括但不限于：矿井、农场、工业基地。这些工业设备可以大幅度提高小镇的生产力和资源储备，连接到小镇商店可以出售多余的资源。

### 小镇判定方式和建立

小镇的判定方式均通过不同的小镇管理方块来定义。小镇管理方块可以通过在服务器主城进行申请来得到，管理方块由 NBT 绑定给小镇所有者，其他人无法冒用。

建立小镇同样需要一定资金储备才能实现，因为需要通过购买地皮和购买其他管理方块来扩充小镇的领域。根据地段不同，地皮价格也有所不同。

### 小镇税收

由于 `Economics` 系统的接入，系统会根据小镇规模来提高小镇的税率。这个税率是作为小镇所有者需要定期交给服务器的一部分资金。这一资金可以由小镇居民提供 (居民高税收) 或小镇所有者通过小镇银行自行负担 (居民高福利)。系统会根据小镇居民税率来对小镇进行不同的分类，在新玩家加入服务器时选择小镇的 GUI 可以查看选择的小镇的税率。

### 小镇合并和战争

LTSX 允许小镇之间通过合理的战斗解决纷争。在 `小镇政府大厅` 中的 `小镇管理方块` 发起开战通知。一旦发起开战，无需经过对方小镇同意即可与对方小镇战斗。在战争期间，小镇保护机制将会取消。小镇内设施和团地内设施都将不受保护。税收系统将会根据小镇战争的持续时间进行调整，战争时间越长，税收越高。

开战后现实时间 48 小时之后可以与对方小镇提出停战协定。停战协定可以由优势方自行制定。对方小镇同意后，小镇解除战争模式，税收、保护系统都会恢复至正常。停战协定包括：

- 割地
- 赔款

`割地` 可以让对方小镇割让一部分地皮，割让后的地皮由优势方占领。一旦优势方割地达到 100%，即吞并对方小镇，此时会执行合并操作，合并后的小镇名称和所有人将由优势方决定。

`赔款` 可以让对方小镇交出一部分钱或资源给优势方，赔款的钱无法超过对方小镇所有资源的 80%。

## 玩家好友系统

RealmsHost 提供了玩家好友系统。现在，对着对方玩家下蹲右键可以打开对方玩家的玩家信息页面。在该页面，可以查看玩家的基本信息。并且可以加对方为好友。加为好友之后的玩家的头衔将会带有 [F] 的字样。好友玩家之间可以进行私聊和转账。

## 重生点选择器

RealmsHost 在玩家死亡之后修改了死亡页面。此时可以让玩家选择重生在附近或选择重生地点。重生地点一般为：`历史死亡地点`、`床`、`小镇(如果有)`、`家`、`服务器主城`。

使用重生点选择器会扣除传送图腾。

## LTSX 特性

RealmsHost 由于是专为 LTSX 设计的，所以针对 LTSX 的需求提供了一系列微调。如：

- /tick 命令
- /manage 命令
- 控制台 Tab 补全
- 基于 MySQL 和 Grafana 的可视化性能面板
- /player 命令
- /hotfix 命令
- /freeze 命令
- /crash 命令
- /toast 命令
- /bossbar 命令
- /chatmsg 命令
- /actionbar 命令

此外，RealmsHost 接管了原版的 MinecraftServer.class，现在由 RealmsHost Extension (RHX) 实现。RHX 提供了像 Paper 等优化特性。

## GUI 组件

RealmsHost 在实现如此多的功能的同时，也实现了针对这些功能的 GUI 组件。如：

- ColorButton - 带颜色的按钮
- AnnouncementComponent - 公告栏

## 集成 REI

RealmsHost 集成了经过修改的 REI。

## 实用工具类

RealmsHost 提供了利于其他模组使用的实用工具类。

- RawCommand - 命令执行器并返回结果（可由玩家或命令方块执行）
- SafeTeleport - 安全传送，不会随机传送到危险的地方

## PlayerHUD

RealmsHost 借鉴了 Create 的列车 HUD 界面，现在可以在 PlayerHUD 中持续显示一些必要信息，如玩家的温度、环境温度、公告、死亡地点等，并且带有一个漂亮的过渡动画。

其他模组可以调用 RealmsHost 的 Interface 来向 PlayerHUD 发送内容来显示。

## 全局的 & 标识符

玩家现在可以在任何地方使用 `&` 来取代 `§`。此外，提供了 `&h` 来修改字体背景颜色，以及 `&+#+RRGGBB` 来定义自己的颜色。

`&` 标识符还可以接 `[component]` 来显示图形，如 `&[teleport_request] context` 来在聊天栏显示一个传送请求样式的字体，这通常带有一个图形背景来衬托文字。